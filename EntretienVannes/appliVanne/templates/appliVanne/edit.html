{% extends "appliVanne/base.html" %} {% load static %} {% block title %} Ajout Vannes {% endblock %}

{% block extra_css%}
<link
  rel="stylesheet"
  href="{% static 'appliVanne/CSS/styleCreationVanne.css' %}" />
{% endblock %}

{% block extra_js%}
    <script src="{% static 'appliVanne/JS/creationVanne.js' %}"></script>
{% endblock%}


{% block main %}

    <h1>Modification de la vanne n°{{vanne.id_vanne}}</h1>
    {% if form.errors %}
    <div class="alert alert-danger">
        <strong>Erreur(s) lors de la soumission du formulaire :</strong>
        <ul>
            {% for field in form %}
                {% if field.errors %}
                    {% for error in field.errors %}
                        <li><strong>{{ field.label|capfirst }}:</strong> {{ error }}</li>
                    {% endfor %}
                {% endif %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <form action="{% url 'traitementModifVanne' %}" method="POST"> <!-- Assurez-vous que l'URL est correcte -->
        {% csrf_token %}
        <input type="hidden" name="id_vanne" value="{{ vanne.id_vanne }}">
        <div id="infoGeneral">

            <div class="form-group">
                <label for="id_atelier">Nom de l'atelier:</label>
                <select name="id_atelier" id="id_atelier" class="form-control">
                    {% for atl in listAtelier %}
                    <option value="{{atl.id_atelier}}" {% if atl.id_atelier == vanne.id_atelier.id_atelier %}selected{% endif %}>{{ atl.nom_atelier }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group" id="nouveauAtelier" style="{% if request.POST.nouveau_atelier %}display:block;{% else %}display:none;{% endif %}">
                <label for="nouveau_atelier">Nom du nouvel Atelier:</label>
                <input type="text" name="nouveau_atelier" id="nouveau_atelier" class="form-control" value="{{ request.POST.nouveau_atelier|default_if_none:'' }}">
            </div>
            
            <!-- Champ repère -->
            <div class="form-group">
                <label for="repere_vanne">Repère:</label>
                <input type="text" name="repere_vanne" id="repere_vanne" class="form-control" value="{{vanne.repere_vanne}}">
            </div>

            <!-- Champ affectation -->
            <div class="form-group">
                <label for="affectation_vanne">Affectation:</label>
                <input type="text" name="affectation_vanne" id="affectation_vanne" class="form-control" value="{{ vanne.affectation_vanne }}">
            </div>

            <!-- Champ numéro de commande -->
            <div class="form-group">
                <label for="numero_commande">Numero de la Commande:</label>
                <input type="text" name="numero_commande" id="numero_commande" class="form-control" value="{{ vanne.numero_commande}}">
            </div>

            <!--Date de la Commande-->
            <div class="form-group">
                <label for="date_de_la_commande">Date de la Commande:</label>
                <input type="date" name="date_de_la_commande" id="date_de_la_commande" class="form-control" value="{{ vanne.date_achat }}">
            </div>

            <!-- Champ type de vanne -->
            <div class="form-group">
                <label for="type_vanne">Type de vanne:</label>
                <select name="type_vanne" id="type_vanne" class="form-control">
                    <option value="1" {% if vanne.type_vannes == "TOR" %}selected{% endif %}>TOR</option>
                    <option value="2" {% if vanne.type_vannes == "REG" %}selected{% endif %}>REG</option>
                </select>
            </div>

            <!--Frequence de revision-->
            <div class="form-group">
                <label>Cette vanne à besoin d'une revision ? </label>
                <select name="infoRevisionBIS" id="infoRevisionBIS" class="form-control">
                    <option value='0' {% if vanne.voir_en == null %} selected {% endif %}>NON</option>
                    <option value='1' {% if request.voir_en != null %} selected {% endif %}>OUI</option>
                </select>
            </div>
                
            <div class="form-group" id="tempsRevision" style="display: none;">
                <label for="tempsRev">À réviser tout les :</label>
                <input type="number" name="tempsRev" id="tempsRev" class="form-control" value="{{ request.POST.tempsRev|default_if_none:'' }}">
                ans
            </div>



        </div>

        <div id="infoCorps">
            <!-- Titre en gras -->
            <h2 class="bold"> Information sur le corps </h2>
        
            <!-- Fournisseur -->
            <div class="form-group">
                <label for="id_fournisseur">Fournisseur:</label>
                <select name="id_fournisseur" id="id_fournisseur" class="form-control">
                    {% for frn in listFournisseur %}
                    <option value="{{frn.id_fournisseur}}" {% if frn.id_fournisseur == vanne.id_corps.id_fournisseur.id_fournisseur %}selected{% endif %}>{{ frn.nom_fournisseur }}</option>
                    {% endfor %}
                </select>
            </div>
        
            <!-- Nouveau Fournisseur -->
            <div class="form-group" id="nouveauFournisseur" style="{% if request.POST.nouveau_fournisseur and request.POST.nouveau_fournisseur != '-1' %}display:block;{% else %}display:none;{% endif %}">
                <label for="nouveau_fournisseur">Nom du Nouveau Fournisseur:</label>
                <input type="text" name="nouveau_fournisseur" id="nouveau_fournisseur" class="form-control" value="{{ request.POST.nouveau_fournisseur|default_if_none:'' }}">
            </div>
        
            <!-- Taille du corps -->
            <div class="form-group">
                <label for="taille_corps">Taille du corps:</label>
                <input type="number" name="taille_corps" id="taille_corps" class="form-control" value="{{ vanne.id_corps.dn_corps }}">
            </div>
        
            <!-- Code du corps -->
            <div class="form-group">
                <label for="code_corps">Code du corps:</label>
                <input type="text" name="code_corps" id="code_corps" class="form-control" value="{{ vanne.id_corps.code_corps }}">
            </div>
        
            <!-- Type de corps -->
            <div class="form-group">
                <label for="type_corps">Type de corps:</label>
                <input type="text" name="type_corps" id="type_corps" class="form-control" value="{{ vanne.id_corps.type_corps }}">
            </div>
        
            <!-- Tableaux d'informations -->
            <div class="table-container">
                <table>
                    <tr>
                        <th>PN Corps</th>
                        <th>CV Corps</th>
                        <th>Numéro de série corps</th>
                    </tr>
                    <tr>
                        <td><input type="number" name="pn_corps" class="form-control" value="{{ vanne.id_corps.pn_corps }}"></td>
                        <td><input type="number" name="cv_corps" class="form-control" value="{{ vanne.id_corps.cv_corps }}"></td>
                        <td><input type="text" name="numero_serie_corps" class="form-control" value="{{ vanne.id_corps.num_serie_corps }}"></td>
                    </tr>
                </table>
        
                <table>
                    <tr>
                        <th>Corps corps</th>
                        <th>Norme bride corps</th>
                        <th>Garniture corps</th>
                        <th>Type garniture</th>
                    </tr>
                    <tr>
                        <td><input type="text" name="corps_corps" class="form-control" value="{{ vanne.id_corps.corps_corps }}"></td>
                        <td><input type="text" name="norme_bride_corps" class="form-control" value="{{ vanne.id_corps.norme_bride_corps|default_if_none:'' }}"></td>
                        <td><input type="text" name="garniture_corps" class="form-control" value="{{ vanne.id_corps.matiere_garnitures_corps }}"></td>
                        <td><input type="text" name="type_garniture" class="form-control" value="{{ vanne.id_corps.type_garniture_corps }}"></td>
                    </tr>
                </table>
        
                <table>
                    <tr>
                        <th>Matière arbre</th>
                        <th>Matière siège</th>
                        <th>Matière organe réglant</th>
                    </tr>
                    <tr>
                        <td><input type="text" name="matiere_arbre" id="id_matiere_arbre" class="form-control" value="{{ vanne.id_corps.matiere_arbre_corps }}"></td>
                        <td><input type="text" name="matiere_siege" id="id_matiere_siege" class="form-control" value="{{ vanne.id_corps.matiere_siege_corps }}"></td>
                        <td><input type="text" name="matiere_organe_reglant" id="id_matiere_organe_reglant" class="form-control" value="{{ vanne.id_corps.matiere_org_reglant_corps }}"></td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div id="infoActionneur">
            <!-- Titre en gras -->
            <h2 class="bold"> Information sur l'actionneur </h2>
        
            <!-- Fournisseur -->
            <div class="form-group">
                <label for="fournisseur">Fournisseur:</label>
                <select name="id_fournisseur_actionneur" id="id_fournisseur_actionneur" class="form-control">
                    {% for frn in listFournisseur %}
                    <option value="{{frn.id_fournisseur}}" {% if frn.id_fournisseur == vanne.id_actionneur.id_fournisseur.id_fournisseur %} selected {% endif %}>{{ frn.nom_fournisseur }}</option>
                    {% endfor %}
                </select>
                <!-- Nouveau Fournisseur Actionneur -->
                <div class="form-group" id="nouveauFournisseurActionneur" style="{% if request.POST.nouveau_fournisseur_actionneur %}display:block;{% else %}display:none;{% endif %}">
                    <label for="nouveauFournisseur">Nom du Nouveau Fournisseur:</label>
                    <input type="text" name="nouveau_fournisseur_actionneur" id="nouveau_fournisseur_actionneur" class="form-control" value="{{ request.POST.nouveau_fournisseur_actionneur|default:'' }}">
                </div>
            </div>
        
            <!-- Taille de l'actionneur -->
            <div class="form-group">
                <label for="taille_actionneur">Taille de l'actionneur:</label>
                <input type="number" name="taille_actionneur" id="id_taille_actionneur" class="form-control" value="{{vanne.id_actionneur.taille_actionneur }}">
            </div>
        
            <!-- Type d'actionneur -->
            <div class="form-group">
                <label for="type_actionneur">Type d'actionneur:</label>
                <input type="text" name="type_actionneur" id="id_type_actionneur" class="form-control" value="{{ vanne.id_actionneur.type_actionneur}}">
            </div>
        
            <!-- Tableaux d'informations -->
            <div class="table-container">
                <table>
                    <tr>
                        <th>Numéro de serie</th>
                        <th>CDE. Manuelle</th>
                        <th>Sens</th>
                    </tr>
                    <tr>
                        <td><input type="text" name="numero_serie_actionneur" id="id_numero_serie_actionneur" class="form-control" value="{{ vanne.id_actionneur.num_serie_actionneur }}"></td>
                        <td>
                            <select name="commande_manuelle_actionneur" id="id_commande_manuelle_actionneur" class="form-control">
                                <option value="1" {% if vanne.id_actionneur.commande_manuel == '1' %} selected {% endif %}>OUI</option>
                                <option value="2" {% if vanne.id_actionneur.commande_manuel == '0' %} selected {% endif %}>NON</option>
                            </select>
                        </td>
                        <td>
                            <select name="sens_actionneur" id="id_sens_actionneur" class="form-control">
                                <option value="1" {% if vanne.id_actionneur.sens_actionneur == 'OMA' %} selected {% endif %}>OMA</option>
                                <option value="2" {% if vanne.id_actionneur.sens_actionneur == 'FMA' %} selected {% endif %}>FMA</option>
                            </select>
                        </td>
                    </tr>
                </table>
        
                <!-- Autres informations sous forme de tableau -->
                <table>
                    <tr>
                        <th>Pression Alim.</th>
                        <th>Type Contact</th>
                        <th>Effet</th>
                    </tr>
                    <tr>
                        <td><input type="text" name="pression_alimentation" id="id_pression_alimentation" class="form-control" value="{{ vanne.id_actionneur.pression_alimentation }}"></td>
                        <td><input type="text" name="type_contact" id="id_type_contact" class="form-control" value="{{ vanne.id_actionneur.type_actionneur }}"></td>
                        <td>
                            <select name="type_effet" id="id_type_effet" class="form-control">
                                <option value="1" {% if vanne.id_actionneur.type_effet == 'SIMPLPE' %} selected {% endif %}>SIMPLE</option>
                                <option value="2" {% if vanne.id_actionneur.type_effet == 'DOUBLE' %} selected {% endif %}>DOUBLE</option>
                            </select>
                        </td>
                    </tr>
                </table>
        
                <table>
                    <tr>
                        <th>Contact</th>
                    </tr>
                    <tr>
                        <td>
                            <select name="type_contact_actionneur" id="id_type_contact_actionneur" class="form-control">
                                <option value="1" {% if vanne.id_actionneur.type_contact_actionneur == 'OUVERTURE' %} selected {% endif %}>OUVERTURE</option>
                                <option value="2" {% if vanne.id_actionneur.type_contact_actionneur == 'FERMETURE' %} selected {% endif %}>FERMETURE</option>
                                <option value="3" {% if vanne.id_actionneur.type_contact_actionneur == 'FERM+OUVER' %} selected {% endif %}>OUVERTURE + FERMETURE</option>
                            </select>
                        </td>                        
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="form-group">
            <div id="infoPositionneurBIS">
            <h3>Il y a un positionneur ?</h3>
            <select name="presence_positionneur" id="presence_positionneur" class="form-control">
                <option value='0' {% if vanne.id_positionneur == null %} selected {% endif %}>NON</option>
                <option value='1' {% if vanne.id_positionneur != null %} selected {% endif %}>OUI</option>
            </select>
            </div>
        </div>
                
        <div id="infoPositionneur" style="display: none;">
            <h2 class="bold"> Information sur le positionneur </h2>
        
            <div class="form-group">
                <label for="fournisseur">Fournisseur:</label>
                <select name="id_fournisseur_positionneur" id="id_fournisseur_positionneur" class="form-control">
                    {% for frn in listFournisseur %}
                    <option value="{{frn.id_fournisseur}}" {% if frn.id_fournisseur == vanne.id_positionneur.id_fournisseur_positionneur %}selected{% endif %}>{{ frn.nom_fournisseur }}</option>
                    {% endfor %}
                </select>
                <div class="form-group" id="nouveauFournisseurPositionneur" style="display:none;">
                    <label for="nouveauFournisseur">Nom du Nouveau Fournisseur:</label>
                    <input type="text" name="nouveau_fournisseur_positionneur" id="nouveau_fournisseur_positionneur" class="form-control" value="{{ request.POST.nouveau_fournisseur_positionneur|default:'' }}">
                </div>
            </div>
        
            <div class="form-group">
                <label for="Fonctionnement positionneur"> Fonctionnement:</label>
                <select name="id_fonctionnement_positionneur" id="id_fonctionnement_positionneur" class="form-control">
                    {% for pos in listTypePos %}
                    <option value="{{pos.id_fonctionnement_postionneur}}" {% if pos.id_fonctionnement_postionneur == vanne.id_positionneur.fonctionnement_positionneur.id_fonctionnement_positionneur %}selected{% endif %}>{{ pos.description_type_positionneur }}</option>
                    {% endfor %}
                </select>
            </div>
        
            <div class="form-group">
                <label for="type_actionneur"> Type positionneur:</label>
                <input type="text" name="type_positionneur" id="id_type_positionneur" value="{{ vanne.id_positionneur.type_positionneur }}" class="form-control">
            </div>
        
            <div class="table-container">
                <table>
                    <tr>
                        <th>Numéro de serie</th>
                        <th>Signal Entrée</th>
                        <th>Alimentation</th>
                    </tr>
                    <tr>
                        <td><input type="text" name="numero_serie_positionneur" id="id_numero_serie_positionneur" value="{{ vanne.id_positionneur.num_serie_positionneur }}" class="form-control"></td>
                        <td><input type="number" name="signal_entree_positionneur" id="id_signal_entree_positionneur" value="{{vanne.id_positionneur.signal_entre_positionneur }}" class="form-control"></td>
                        <td><input type="text" name="alimentation_positionneur" id="id_alimentation_positionneur" value="{{vanne.id_positionneur.presion_positionneur }}" class="form-control"></td>
                    </tr>
                </table>
        
                <table>
                    <tr>
                        <th>Signal sortie</th>
                        <th>Repere Came</th>
                        <th>Face Came</th>
                    </tr>
                    <tr>
                        <td><input type="number" name="signal_sortie_positionneur" id="id_signal_sortie_positionneur" value="{{ vanne.id_positionneur.signal_sortie }}" class="form-control"></td>
                        <td><input type="number" name="repere_came_positionneur" id="id_repere_came_positionneur" value="{{ vanne.id_positionneur.repere_came }}" class="form-control"></td>
                        <td><input type="number" name="face_came_positionneur" id="id_face_came_positionneur" value="{{ vanne.id_positionneur.face_came }}" class="form-control"></td>
                    </tr>
                </table>
        
                <table>
                    <tr>
                        <th>Sens Action</th>
                        <th>Fermée à</th>
                        <th>Ouverte à</th>
                        <th>Loi de commande</th>
                    </tr>
                    <tr>
                        <td>
                            <select name="sens_action" id="id_sens_action" class="form-control">
                                <option value="1" {% if vanne.id_positionneur.sens_action == 'DIRECT' %}selected{% endif %}>DIRECT</option>
                                <option value="2" {% if vanne.id_positionneur.sens_action == 'INVERSE' %}selected{% endif %}>INVERSE</option>
                            </select>
                        </td>
                        <td><input type="number" name="fermee_a_positionneur" id="id_fermee_a_positionneur" value="{{ vanne.id_positionneur.fermer_a }}" class="form-control"></td>
                        <td><input type="number" name="ouverte_a_positionneur" id="id_ouverte_a_positionneur" value="{{ vanne.id_positionneur.ouvert_a }}" class="form-control"></td>
                        <td><input type="text" name="loi_commande_positionneur" id="id_loi_commande_positionneur" value="{{ vanne.id_positionneur.loi_positionneur }}" class="form-control"></td>
                    </tr>
                </table>
            </div>
        </div>
        
        
        <button type="submit" class="btn btn-primary">ENREGISTRER LA VANNE</button>

    </form>
        


        

    {% endblock %}
